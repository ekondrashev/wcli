<html>
    <head>
        <link rel="stylesheet" href="http://static.jquery.com/ui/css/demo-docs-theme/ui.theme.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.14/themes/base/jquery-ui.css" type="text/css" media="all" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js" type="text/javascript">
        </script>
        <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.14/jquery-ui.min.js" type="text/javascript">
        </script>
        <script src="http://jquery-ui.googlecode.com/svn/tags/latest/external/jquery.bgiframe-2.1.2.js" type="text/javascript">
        </script>
        <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.14/i18n/jquery-ui-i18n.min.js" type="text/javascript">
        </script>
    </head>
    <meta charset="utf-8">
    <style type="text/css">
        
        #project-label {
            display: block;
            font-weight: bold;
            margin-bottom: 1em;
        }
        
        #project-icon {
            float: left;
            height: 32px;
            width: 32px;
        }
        
        #project-description {
            margin: 0;
            padding: 0;
        }
        
        .ui-menu .ui-menu-item a {
            font-size: 10px;
        }
        
        body {
            width: 250;
            height: 300;
        }
    </style>
    <script>
        $(function(){
            //            var projects = [{
            //                value: "jquery",
            //                label: "jQuery",
            //                desc: "the write less, do more, JavaScript library",
            //                icon: "jquery_32x32.png"
            //            }, {
            //                value: "jquery-ui",
            //                label: "jQuery UI",
            //                desc: "the official user interface library for jQuery",
            //                icon: "jqueryui_32x32.png"
            //            }, {
            //                value: "sizzlejs",
            //                label: "Sizzle JS",
            //                desc: "a pure-JavaScript CSS selector engine",
            //                icon: "sizzlejs_32x32.png"
            //            }];
            var projects = chrome.extension.getBackgroundPage().globalLinks;
            
            $("#project").autocomplete({
                minLength: 0,
                source: projects,
                focus: function(event, ui){
                    $("#project").val(ui.item.label);
                    return false;
                },
                //                select: function(event, ui){
                //                    $("#project").val(ui.item.label);
                //                    $("#project-id").val(ui.item.value);
                //                    $("#project-description").html(ui.item.href);
                //                    $("#project-icon").attr("src", "images/" + ui.item.icon);
                //                    
                //                    return false;
                select: function(event, ui){
                    chrome.tabs.getSelected(null, function(tab){
                        chrome.tabs.sendRequest(tab.id, {
                            "name": ui.item.label,
                            "href": ui.item.href
                        }, function readResponse(){
                            console.log("got response in popup");
                        });
                        window.close();
                    });
                    return false;
                }
            }).data("autocomplete")._renderItem = function(ul, item){
                return $("<li></li>").data("item.autocomplete", item).append("<a>" + item.label + "<br>" + item.href + "</a>").appendTo(ul);
            };
        });
        
        
        //		alert(chrome.extension.getBackgroundPage().globalLinks);
        //		javascript:(function(){for(i=0;i<document.links.length;i++)document.links[i].style.backgroundColor='#ffff00';})();
        //		
        //            for (i = 0; i < document.links.length; i++) {
        //				alert(document.links[i]);
        //				document.links[i].style.backgroundColor = '#ffff00';
        //				
        //			}
    </script>
    <body>
        <div class="demo">
            <div id="project-label">
                Go to (start typing a link):
            </div>
            <!--
            <img id="project-icon" src="/demos/autocomplete/images/transparent_1x1.png"  class="ui-state-default"//>
            --><input id="project"/><input type="hidden" id="project-id"/>
            <p id="project-description">
            </p>
        </div>
    </body>
    <!-- End demo -->
    <script type="text/javascript" language="javascript">
        document.getElementById("project").focus();
    </script>
</html>
